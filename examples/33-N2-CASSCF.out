#INFO: **** input file is /share/home/srwang/pyAutoMR/examples/33-N2-CASSCF.py ****
from pyscf import lib
#from pyphf import util, guess
from automr import guess, autocas, cidump

lib.num_threads(4)

xyz = 'N 0.0 0.0 0.0; N  0.0 0.0 1.9' #sys.argv[1]
#fch = 'n2.fchk' #sys.argv[2]
bas = 'cc-pvdz'

mf = guess.from_frag(xyz, bas, [[0],[1]], [0,0], [3,-3], cycle=50)
mf = guess.check_stab(mf)

mf2 = autocas.cas(mf)
cidump.dump(mf2)

#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='xn01', release='3.10.0-1127.el7.x86_64', version='#1 SMP Tue Feb 18 16:39:12 EST 2020', machine='x86_64', processor='x86_64')  Threads 4
Python 3.7.4 (default, Aug 13 2019, 20:35:49) 
[GCC 7.3.0]
numpy 1.17.2  scipy 1.4.1
Date: Sat Jul 10 15:04:08 2021
PySCF version 1.7.6a1
PySCF path  /share/home/srwang/pyscf/pyscf
GIT HEAD      ref: refs/heads/master
GIT master branch  80f71dfe77ac5f9caae26788acf76446987635bd

[CONFIG] conf_file /share/home/srwang/.pyscf_conf.py
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 14
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 N      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 N      0.000000000000   0.000000000000   1.900000000000 AA    0.000000000000   0.000000000000   3.590479636674 Bohr

nuclear repulsion = 13.6472017553053
number of shells = 10
number of NR pGTOs = 52
number of NR cGTOs = 28
basis = cc-pvdz
ecp = {}
CPU time:         0.47
**** generating fragment guess ****
fragments: [('N', [0.0, 0.0, 0.0])] [('N', [0.0, 0.0, 1.9])]
converged SCF energy = -54.3911145621998  <S^2> = 3.7540306  2S+1 = 4.0020148
converged SCF energy = -54.3911145621998  <S^2> = 3.7540306  2S+1 = 4.0020148
       na   nb
atom1   5    2
atom2   2    5


******** <class 'pyscf.scf.uhf.UHF'> ********
method = UHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /share/home/srwang/pyAutoMR/examples/tmp81586oaj
max_memory 4000 MB (current use 89 MB)
number electrons alpha = 7  beta = 7
Set gradient conv threshold to 3.16228e-05
init E= -108.900143275272
  alpha nocc = 7  HOMO = -0.476464499402216  LUMO = 0.166732176142525
  beta  nocc = 7  HOMO = -0.476464499402215  LUMO = 0.166732176142526
cycle= 1 E= -108.762288631731  delta_E= 0.138  |g|= 0.0527  |ddm|= 0.373
  alpha nocc = 7  HOMO = -0.530330642057186  LUMO = 0.162348570448283
  beta  nocc = 7  HOMO = -0.530330642057184  LUMO = 0.162348570448285
cycle= 2 E= -108.765642733546  delta_E= -0.00335  |g|= 0.0253  |ddm|= 0.0587
  alpha nocc = 7  HOMO = -0.529049671912858  LUMO = 0.159261512802591
  beta  nocc = 7  HOMO = -0.529049671912859  LUMO = 0.159261512802599
cycle= 3 E= -108.767085606679  delta_E= -0.00144  |g|= 0.0126  |ddm|= 0.0548
  alpha nocc = 7  HOMO = -0.528710372834673  LUMO = 0.156378931797931
  beta  nocc = 7  HOMO = -0.528710372834673  LUMO = 0.156378931797932
cycle= 4 E= -108.767469881852  delta_E= -0.000384  |g|= 0.00324  |ddm|= 0.0393
  alpha nocc = 7  HOMO = -0.527321353128721  LUMO = 0.15690565068073
  beta  nocc = 7  HOMO = -0.527321353128717  LUMO = 0.156905650680732
cycle= 5 E= -108.767488344339  delta_E= -1.85e-05  |g|= 0.000626  |ddm|= 0.0078
  alpha nocc = 7  HOMO = -0.527670443529383  LUMO = 0.156831110667569
  beta  nocc = 7  HOMO = -0.527670443529387  LUMO = 0.156831110667576
cycle= 6 E= -108.767488867958  delta_E= -5.24e-07  |g|= 0.000143  |ddm|= 0.00108
  alpha nocc = 7  HOMO = -0.527603375860148  LUMO = 0.156896336092541
  beta  nocc = 7  HOMO = -0.527603375860146  LUMO = 0.156896336092538
cycle= 7 E= -108.767488893983  delta_E= -2.6e-08  |g|= 4.93e-05  |ddm|= 0.000239
  alpha nocc = 7  HOMO = -0.52765070515318  LUMO = 0.156872500788261
  beta  nocc = 7  HOMO = -0.527650705153182  LUMO = 0.156872500788269
cycle= 8 E= -108.767488898007  delta_E= -4.02e-09  |g|= 1.06e-05  |ddm|= 9.2e-05
  alpha nocc = 7  HOMO = -0.527658756971653  LUMO = 0.15687470693499
  beta  nocc = 7  HOMO = -0.527658756971652  LUMO = 0.156874706934988
cycle= 9 E= -108.76748889822  delta_E= -2.13e-10  |g|= 1.78e-06  |ddm|= 2.85e-05
  alpha nocc = 7  HOMO = -0.527658437248201  LUMO = 0.156874663133346
  beta  nocc = 7  HOMO = -0.527658437248201  LUMO = 0.15687466313335
Extra cycle  E= -108.767488898223  delta_E= -2.49e-12  |g|= 6.81e-07  |ddm|= 2.47e-06
converged SCF energy = -108.767488898223  <S^2> = 2.6423741  2S+1 = 3.4013963
time for guess: 0.217
**** checking UHF/UKS internal stability ...
tol 0.0001  toloose 0.01
max_cycle 50  max_space 12  max_memory 2000  incore True
davidson 0 1  |r|= 2.37  e= [2.261294]  max|de|= 2.26  lindep= 0.685
davidson 1 2  |r|= 1.24  e= [1.347562]  max|de|= -0.914  lindep= 0.886
davidson 2 3  |r|= 0.353  e= [0.740493]  max|de|= -0.607  lindep= 0.995
davidson 3 4  |r|= 0.305  e= [0.595557]  max|de|= -0.145  lindep= 0.942
davidson 4 5  |r|= 0.117  e= [0.543459]  max|de|= -0.0521  lindep= 0.985
davidson 5 6  |r|= 0.0414  e= [0.538236]  max|de|= -0.00522  lindep= 0.961
davidson 6 7  |r|= 0.0258  e= [0.537135]  max|de|= -0.0011  lindep= 0.918
davidson 7 8  |r|= 0.0178  e= [0.536572]  max|de|= -0.000562  lindep= 0.955
davidson 8 9  |r|= 0.0367  e= [0.535947]  max|de|= -0.000626  lindep= 0.949
davidson 9 10  |r|= 0.0264  e= [0.534875]  max|de|= -0.00107  lindep= 0.942
davidson 10 11  |r|= 0.0237  e= [0.534334]  max|de|= -0.00054  lindep= 0.943
davidson 11 12  |r|= 0.0271  e= [0.534005]  max|de|= -0.000329  lindep= 0.822
davidson 12 1  |r|= 0.0271  e= [0.534005]  max|de|= 6.66e-16  lindep=    1
davidson 13 2  |r|= 0.0186  e= [0.533829]  max|de|= -0.000177  lindep= 0.823
davidson 14 3  |r|= 0.0115  e= [0.533683]  max|de|= -0.000145  lindep= 0.938
davidson 15 4  |r|= 0.0114  e= [0.533563]  max|de|= -0.00012  lindep= 0.916
root 0 converged  |r|= 0.00586  e= 0.5335164750529766  max|de|= -4.66e-05
converged 16 5  |r|= 0.00586  e= [0.533516]  max|de|= -4.66e-05
UHF/UKS wavefunction is stable in the internal stability analysis
UNO ON: [ 2.        2.        1.999103  1.997838  1.550306  1.174501  1.174501  0.825499  0.825499  0.449694  0.002162  0.000897  0.        0.        0.
  0.        0.        0.        0.        0.        0.       -0.       -0.       -0.       -0.       -0.       -0.       -0.      ]
nacto, nacta, nactb: 6 3 3
Converting <class 'pyscf.scf.uhf.UHF'> to RHF
UNO in active space
             #0      #1      #2      #3      #4      #5     
  0 N 3s                                               0.184
  0 N 2px              0.411   0.203  -0.112   0.494        
  0 N 2py              0.203  -0.411   0.494   0.112        
  0 N 2pz     -0.442                                   0.565
  0 N 3px              0.281   0.139           0.328        
  0 N 3py              0.139  -0.281   0.328                
  0 N 3pz     -0.295                                   0.390
  1 N 3s                                              -0.184
  1 N 2px              0.411   0.203   0.112  -0.494        
  1 N 2py              0.203  -0.411  -0.494  -0.112        
  1 N 2pz      0.442                                   0.565
  1 N 3px              0.281   0.139          -0.328        
  1 N 3py              0.139  -0.281  -0.328                
  1 N 3pz      0.295                                   0.390

******** <class 'pyscf.mcscf.mc1step.CASSCF'> ********
CAS (3e+3e, 6o), ncore = 4, nvir = 18
max_cycle_macro = 200
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 0
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = True
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /share/home/srwang/pyAutoMR/examples/tmp81586oaj
max_memory 1000 MB (current use 92 MB)
internal_rotation = False
******** <class 'pyscf.fci.direct_spin1.FCISolver'> ********
max. cycles = 100
conv_tol = 1e-08
davidson only = False
linear dependence = 1e-10
level shift = 0.001
max iter space = 12
max_memory 1000 MB
nroots = 1
pspace_size = 400
spin = 0
CASCI E = -108.799475961089  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
macro iter 1 (12 JK  4 micro), CASSCF E = -108.800824503827  dE = -0.0013485427  S^2 = 0.0000001
               |grad[o]|=0.0392  |grad[c]|= 0.0016643544928822674  |ddm|=0.0463
macro iter 2 (6 JK  2 micro), CASSCF E = -108.800824782567  dE = -2.7873958e-07  S^2 = 0.0000000
               |grad[o]|=0.000659  |grad[c]|= 2.0210383431047432e-05  |ddm|=0.00026
macro iter 3 (1 JK  1 micro), CASSCF E = -108.80082478276  dE = -1.9370816e-10  S^2 = 0.0000000
               |grad[o]|=2.51e-05  |grad[c]|= 9.94169625494495e-06  |ddm|=1.86e-05
1-step CASSCF converged in 3 macro (19 JK 7 micro) steps
CASSCF canonicalization
Natural occ [1.733012 1.391514 1.391514 0.60848  0.608479 0.267001]
Natural orbital (expansion on AOs) in CAS space
               #1        #2        #3        #4        #5       
  0 N 1s      -0.00068   0.00000   0.00000   0.00000  -0.00000
  0 N 2s      -0.00511   0.00000   0.00000   0.00000  -0.00000
  0 N 3s       0.05371  -0.00000  -0.00000   0.00000   0.00000
  0 N 2px     -0.00000   0.43899   0.10394  -0.11681   0.50110
  0 N 2py     -0.00000   0.10394  -0.43898   0.50110   0.11681
  0 N 2pz     -0.43997   0.00000   0.00000  -0.00000  -0.00000
  0 N 3px     -0.00000   0.31194   0.07386  -0.07390   0.31700
  0 N 3py     -0.00000   0.07386  -0.31195   0.31701   0.07390
  0 N 3pz     -0.29468  -0.00000   0.00000  -0.00000  -0.00000
  0 N 3dxy     0.00000   0.00000  -0.00000   0.00000  -0.00000
  0 N 3dyz     0.00000   0.00275  -0.01161   0.00557   0.00130
  0 N 3dz^2   -0.02028  -0.00000  -0.00000  -0.00000  -0.00000
  0 N 3dxz     0.00000   0.01161   0.00275  -0.00130   0.00557
 0 N 3dx2-y2  -0.00000  -0.00000  -0.00000   0.00000  -0.00000
  1 N 1s      -0.00068  -0.00000   0.00000  -0.00000  -0.00000
  1 N 2s      -0.00511  -0.00000   0.00000  -0.00000  -0.00000
  1 N 3s       0.05371   0.00000   0.00000  -0.00000   0.00000
  1 N 2px     -0.00000   0.43899   0.10394   0.11681  -0.50110
  1 N 2py     -0.00000   0.10394  -0.43899  -0.50110  -0.11681
  1 N 2pz      0.43997  -0.00000  -0.00000  -0.00000  -0.00000
  1 N 3px      0.00000   0.31194   0.07386   0.07390  -0.31700
  1 N 3py      0.00000   0.07386  -0.31194  -0.31701  -0.07390
  1 N 3pz      0.29468   0.00000  -0.00000   0.00000   0.00000
  1 N 3dxy     0.00000  -0.00000   0.00000   0.00000   0.00000
  1 N 3dyz    -0.00000  -0.00275   0.01161   0.00557   0.00130
  1 N 3dz^2   -0.02028   0.00000   0.00000   0.00000   0.00000
  1 N 3dxz    -0.00000  -0.01161  -0.00275  -0.00130   0.00557
 1 N 3dx2-y2   0.00000  -0.00000  -0.00000   0.00000   0.00000
               #6       
  0 N 1s       0.00450
  0 N 2s       0.09824
  0 N 3s       0.17696
  0 N 2px      0.00000
  0 N 2py      0.00000
  0 N 2pz      0.57925
  0 N 3px     -0.00000
  0 N 3py     -0.00000
  0 N 3pz      0.35815
  0 N 3dxy     0.00000
  0 N 3dyz     0.00000
  0 N 3dz^2    0.00398
  0 N 3dxz    -0.00000
 0 N 3dx2-y2   0.00000
  1 N 1s      -0.00450
  1 N 2s      -0.09824
  1 N 3s      -0.17696
  1 N 2px      0.00000
  1 N 2py      0.00000
  1 N 2pz      0.57925
  1 N 3px     -0.00000
  1 N 3py     -0.00000
  1 N 3pz      0.35815
  1 N 3dxy     0.00000
  1 N 3dyz    -0.00000
  1 N 3dz^2   -0.00398
  1 N 3dxz     0.00000
 1 N 3dx2-y2   0.00000
<CAS-nat-orb|mo-hf>  5  5    0.99930057
<CAS-nat-orb|mo-hf>  6  6    0.97448608
<CAS-nat-orb|mo-hf>  7  7    0.97448607
<CAS-nat-orb|mo-hf>  8  8    0.99990790
<CAS-nat-orb|mo-hf>  9  9    0.99990787
<CAS-nat-orb|mo-hf>  10  10    0.99954893
CASSCF energy = -108.80082478276
CASCI E = -108.80082478276  E(CI) = -9.66807332507661  S^2 = 0.0000000
Natrual Orbs
             #0      #1      #2      #3      #4      #5     
  0 N 3s                                               0.184
  0 N 2px              0.411   0.203  -0.112   0.494        
  0 N 2py              0.203  -0.411   0.494   0.112        
  0 N 2pz     -0.442                                   0.565
  0 N 3px              0.281   0.139           0.328        
  0 N 3py              0.139  -0.281   0.328                
  0 N 3pz     -0.295                                   0.390
  1 N 3s                                              -0.184
  1 N 2px              0.411   0.203   0.112  -0.494        
  1 N 2py              0.203  -0.411  -0.494  -0.112        
  1 N 2pz      0.442                                   0.565
  1 N 3px              0.281   0.139          -0.328        
  1 N 3py              0.139  -0.281  -0.328                
  1 N 3pz      0.295                                   0.390
***** CI components ******
 c**2   Gaussian-type vector
 0.406420  111000 
 0.117311  110100 
 0.117311  101010 
 0.047997  100110 
 0.040414  1baab0 
 0.040414  1abba0 
 0.025725  011001 
 0.016043  1abab0 
 0.016043  1baba0 
 0.014108  010101 
 0.014108  001011 
 0.011759  000111 
 0.010349  a1bb0a 
 0.010349  b1aa0b 
 0.010349  ab10ba 
 0.010349  ba10ab 
 c**2     ORCA-type vector
 0.406420  222000 
 0.117311  220200 
 0.117311  202020 
 0.112915  211110 
 0.047997  200220 
 0.025725  022002 
 0.020698  121101 
 0.020698  112011 
 0.014108  020202 
 0.014108  002022 
 0.011759  000222 
